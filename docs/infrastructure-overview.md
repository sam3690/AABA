# Infrastructure Overview

This document captures the base infrastructure layout for the Autonomous AI Business Administration (AABA) platform.

## Core services

- **API Gateway (`backend`)** – FastAPI application that exposes job/task Orchestration endpoints.
- **Worker Pool (`celery-worker`)** – Celery worker instances that execute asynchronous workloads dispatched by the API/orchestrator layer.
- **Scheduler (`celery-beat`)** – Triggers recurring automations and health checks.
- **Real-time events (`redis`)** – Acts as the Celery broker/backing store for short-lived state.
- **Primary SQL store (`postgres`)** – Stores durable relational data, job definitions, and audit events.
- **Operational datastore (`mongo`)** – Captures semi-structured business artefacts, agent transcripts, and connectors state.
- **Object & document queue (`minio`)** – Holds file attachments and export bundles generated by automations.
- **Vector index (`weaviate`)** – Provides semantic indexing and retrieval for agent memory.

## Integrations hub

- **Message Bus (`nats`)** – Pub/Sub channel for downstream automation services and external connectors.
- **Webhook relay (`tunnel`)** – Secure ingress (e.g., Cloudflare Tunnel/ngrok) for SaaS callbacks when developing locally.
- **Integration connectors** – Placeholder services (Stripe, Salesforce, Slack, Gmail, QuickBooks, HubSpot) accessed through task-specific Celery queues. Credentials are managed by environment variables and HashiCorp Vault in production.

## Monitoring & Observability

- **OpenTelemetry Collector (`otel-collector`)** – Normalizes traces, metrics, and logs from API and workers.
- **Prometheus** – Scrapes metrics from API, workers, Redis, Postgres, and the collector.
- **Grafana** – Unified dashboards for service health and business KPIs.
- **Loki + Promtail** – Centralized structured logs with fast filtering.
- **Jaeger** – Distributed tracing UI backed by storage provided by Elasticsearch/OpenSearch (future).

## Local developer experience

- **Flower** – Celery task monitoring UI.
- **pgAdmin** – Postgres management.
- **Mongo Express** – MongoDB explorer.

## Secrets & configuration

- `.env` is used for local development. A committed `.env.example` contains sane defaults.
- `app/core/config.py` loads configuration via `pydantic-settings` (planned migration) but currently uses environment variables with defaults.
- Production deployments source secrets from managed stores (AWS/GCP/Azure) with per-environment overrides.

## Data flow summary

1. Clients call the FastAPI gateway.
2. FastAPI dispatches background jobs to Celery via Redis.
3. Workers persist intermediate state to Postgres/Mongo and publish domain events to NATS.
4. Downstream connectors subscribe to NATS subjects to interact with SaaS platforms.
5. Monitoring pipeline exports metrics/logs/traces to the observability stack.
6. Human operators use Grafana, Flower, and database UIs for oversight.

This document guides the compose/Kubernetes manifests and the application configuration that follow.
